<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>İçerik Detayı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <style>
        #postDetail {padding: 15px;}
        #postDetail p {padding: 10px;text-align: left;}
        #postDetail h2 {text-align: left;padding: 15px;}
        #postDetail p.text-muted {background: #eee; border-radius: 4px;}
        #postDetail p.text-muted:after {content: " Tarihinde Yazıldı."}
    
    </style>
</head>
<div id="progressBar" style="position:fixed;top:0;left:0;height:4px;background:#007bff;width:0;display:none;z-index:9999;"></div>
<body id="postbody" class="bg-light">

    <nav class="navbar navbar-light shadow-sm bg-white px-4">
        <a class="navbar-brand" href="/">← Anasayfa</a>
        <div class="ms-auto"><a href="#Kategoriler" class="btn btn-outline-dark">Kategoriler</a></div>
    </nav>

    <main class="container my-5">
        <div id="postDetail" class="text-center card shadow-sm border-0 text-dark">Yükleniyor...</div>
    </main>


    <script>
        // Türkçe karakterleri URL uyumlu hale getirir
        function slugify(text) {
            const trMap = {
                ç: "c", ğ: "g", ı: "i", ö: "o", ş: "s", ü: "u",
                Ç: "C", Ğ: "G", İ: "I", Ö: "O", Ş: "S", Ü: "U"
            };
            return text.split("")
                .map(c => trMap[c] || c)
                .join("")
                .toLowerCase()
                .replace(/\s+/g, "-")
                .replace(/[^a-z0-9\-]/g, "")
                .replace(/\-+/g, "-");
        }

        async function loadPost() {
            const pathParts = window.location.pathname.split("/");
            // /post/slug --> slug index 2'de
            const slug = pathParts[2];
            const container = document.getElementById("postDetail");



            if (!slug) {
                container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                return;
            }

            try {
                const res = await fetch("/api/posts");
                if (!res.ok) throw new Error("Veriler alınamadı.");

                const posts = await res.json();

                const matchedPost = posts.find(p => slugify(p.title) === slug);

                if (matchedPost) {
                    document.title = matchedPost.title + " | hsnesr";
                    container.innerHTML = `
                    <h2>${matchedPost.title}</h2>
                    <p class="text-muted">${new Date(matchedPost.created_at).toLocaleDateString()}</p>
                    <p>${matchedPost.content}</p>
                  `;
                } else {
                    container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="alert alert-danger">Sunucu hatası.</div>';
            }
        }

        loadPost();

    </script>

</body>
</html>
