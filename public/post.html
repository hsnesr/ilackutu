<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>İçerik Detayı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css" />
    <style>
        #postDetail {padding: 15px;}
        #postDetail p {padding: 10px;text-align: left;}
        #postDetail h2 {text-align: left;padding: 15px;}
        #postDetail p.text-muted {background: #f3f3f3; border-radius: 4px;}
        #postDetail p.text-muted:after {content: " Tarihinde Yazıldı."}
    </style>
</head>
<body id="postbody" class="bg-light">
<div id="progressBar" style="position:fixed;top:0;left:0;height:4px;background:#0d6efd;width:0;display:none;z-index:9999;"></div>

    

     <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="javascript:history.back()">Geri Dön</a>

    <button class="navbar-toggler mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavDropdown">

      <!-- Arama Kutusu (İsteğe Bağlı) -->
      <form class="d-flex ms-auto" style="width:100%">
        <input class="form-control me-2" type="search" placeholder="Ara...">
        <button class="btn btn-primary" style="width:150px" type="submit"><i class="fas fa-search"></i></button>
      </form>
    </div>
  </div>
</nav>

    <main class="container my-5">
        <div id="postDetail" class="text-center card shadow-sm border-0 text-dark">Yükleniyor...</div>
    </main>


    <script>
        // Türkçe karakterleri URL uyumlu hale getirir
        function slugify(text) {
            const trMap = {
                ç: "c", ğ: "g", ı: "i", ö: "o", ş: "s", ü: "u",
                Ç: "C", Ğ: "G", İ: "I", Ö: "O", Ş: "S", Ü: "U"
            };
            return text.split("")
                .map(c => trMap[c] || c)
                .join("")
                .toLowerCase()
                .replace(/\s+/g, "-")
                .replace(/[^a-z0-9\-]/g, "")
                .replace(/\-+/g, "-");
        }

        async function loadPost() {
            const pathParts = window.location.pathname.split("/");
            // /post/slug --> slug index 2'de
            const slug = pathParts[2];
            const container = document.getElementById("postDetail");



            if (!slug) {
                container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                return;
            }

            try {
                const res = await fetch("/api/posts");
                if (!res.ok) throw new Error("Veriler alınamadı.");

                const posts = await res.json();

                const matchedPost = posts.find(p => slugify(p.title) === slug);

                if (matchedPost) {
                    document.title = matchedPost.title + " | hsnesr";
                    container.innerHTML = `
                    <h2>${matchedPost.title}</h2>
                    <p class="text-muted">${new Date(matchedPost.created_at).toLocaleDateString()}</p>
                    <p>${matchedPost.content}</p>
                  `;
                } else {
                    container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="alert alert-danger">Sunucu hatası.</div>';
            }
        }

        loadPost();

    </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
