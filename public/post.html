<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>İçerik Detayı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark px-4">
        <a class="navbar-brand" href="/">← Anasayfa</a>
    </nav>

    <main class="container my-5">
        <div id="postDetail" class="text-center">Yükleniyor...</div>
    </main>

    <script>
        function slugify(text) {
            const trMap = {
                ç: "c", Ç: "C", ğ: "g", Ğ: "G",
                ı: "i", İ: "i", ö: "o", Ö: "O",
                ş: "s", Ş: "S", ü: "u", Ü: "U"
            };

            return text
                .split("")
                .map(char => trMap[char] || char)
                .join("")
                .toLowerCase()
                .replace(/\s+/g, "-")
                .replace(/[^a-z0-9\-]/g, "")
                .replace(/\-+/g, "-")
                .replace(/^\-+|\-+$/g, "");
        }

        async function loadPost() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get("slug");
            const container = document.getElementById("postDetail");

            if (!slug) {
                container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                return;
            }

            try {
                const res = await fetch("/api/posts");
                const posts = await res.json();

                const matchedPost = posts.find(p => slugify(p.title) === slug);

                if (matchedPost) {
                    document.title = matchedPost.title + " | hsnesr";
                    container.innerHTML = `
                <h2>${matchedPost.title}</h2>
                <p class="text-muted">${new Date(matchedPost.created_at).toLocaleDateString()}</p>
                <p>${matchedPost.content}</p>
              `;
                } else {
                    container.innerHTML = '<div class="alert alert-danger">İçerik bulunamadı.</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="alert alert-danger">Sunucu hatası.</div>';
            }
        }

        loadPost();
    </script>
</body>
</html>
